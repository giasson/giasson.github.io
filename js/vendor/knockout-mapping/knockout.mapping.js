!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],e):e(ko,ko.mapping={})}(function(e,exports){function t(e,t){for(var n={},i=e.length-1;i>=0;--i)n[e[i]]=e[i];for(var i=t.length-1;i>=0;--i)n[t[i]]=t[i];var r=[];for(var o in n)r.push(n[o]);return r}function n(e,i){var r;for(var o in i)if(i.hasOwnProperty(o)&&i[o])if(r=exports.getType(e[o]),o&&e[o]&&"array"!==r&&"string"!==r)n(e[o],i[o]);else{var a="array"===exports.getType(e[o])&&"array"===exports.getType(i[o]);e[o]=a?t(e[o],i[o]):i[o]}}function i(e,t){var i={};return n(i,e),n(i,t),i}function r(e,t){for(var n=i({},e),r=k.length-1;r>=0;r--){var a=k[r];n[a]&&(n[""]instanceof Object||(n[""]={}),n[""][a]=n[a],delete n[a])}return t&&(n.ignore=o(t.ignore,n.ignore),n.include=o(t.include,n.include),n.copy=o(t.copy,n.copy),n.observe=o(t.observe,n.observe)),n.ignore=o(n.ignore,T.ignore),n.include=o(n.include,T.include),n.copy=o(n.copy,T.copy),n.observe=o(n.observe,T.observe),n.mappedProperties=n.mappedProperties||{},n.copiedProperties=n.copiedProperties||{},n}function o(t,n){return"array"!==exports.getType(t)&&(t="undefined"===exports.getType(t)?[]:[t]),"array"!==exports.getType(n)&&(n="undefined"===exports.getType(n)?[]:[n]),e.utils.arrayGetDistinctValues(t.concat(n))}function a(t,n){var i=e.dependentObservable;e.dependentObservable=function(n,i,r){r=r||{},n&&"object"==typeof n&&(r=n);var o=r.deferEvaluation,a=!1,s=function(n){var i=e.dependentObservable;e.dependentObservable=w;var r=e.isWriteableObservable(n);e.dependentObservable=i;var o=w({read:function(){return a||(e.utils.arrayRemoveItem(t,n),a=!0),n.apply(n,arguments)},write:r&&function(e){return n(e)},deferEvaluation:!0});return b&&(o._wrapper=!0),o.__DO=n,o};r.deferEvaluation=!0;var l=new w(n,i,r);return o||(l=s(l),t.push(l)),l},e.dependentObservable.fn=w.fn,e.computed=e.dependentObservable;var r=n();return e.dependentObservable=i,e.computed=e.dependentObservable,r}function s(t,n,r,o,d,p,g){var m="array"===exports.getType(e.utils.unwrapObservable(n));if(p=p||"",exports.isMapped(t)){var b=e.utils.unwrapObservable(t)[y];r=i(b,r)}var w={data:n,parent:g||d},x=function(){return r[o]&&r[o].create instanceof Function},k=function(t){return a(v,function(){return r[o].create(e.utils.unwrapObservable(d)instanceof Array?{data:t||w.data,parent:w.parent,skip:j}:{data:t||w.data,parent:w.parent})})},C=function(){return r[o]&&r[o].update instanceof Function},T=function(t,n){var i={data:n||w.data,parent:w.parent,target:e.utils.unwrapObservable(t)};return e.isWriteableObservable(t)&&(i.observable=t),r[o].update(i)},S=_.get(n);if(S)return S;if(o=o||"",m){var E=[],A=!1,O=function(e){return e};r[o]&&r[o].key&&(O=r[o].key,A=!0),e.isObservable(t)||(t=e.observableArray([]),t.mappedRemove=function(e){var n="function"==typeof e?e:function(t){return t===O(e)};return t.remove(function(e){return n(O(e))})},t.mappedRemoveAll=function(n){var i=u(n,O);return t.remove(function(t){return-1!=e.utils.arrayIndexOf(i,O(t))})},t.mappedDestroy=function(e){var n="function"==typeof e?e:function(t){return t===O(e)};return t.destroy(function(e){return n(O(e))})},t.mappedDestroyAll=function(n){var i=u(n,O);return t.destroy(function(t){return-1!=e.utils.arrayIndexOf(i,O(t))})},t.mappedIndexOf=function(n){var i=u(t(),O),r=O(n);return e.utils.arrayIndexOf(i,r)},t.mappedGet=function(e){return t()[t.mappedIndexOf(e)]},t.mappedCreate=function(n){if(-1!==t.mappedIndexOf(n))throw new Error("There already is an object with the key that you specified.");var i=x()?k(n):n;if(C()){var r=T(i,n);e.isWriteableObservable(i)?i(r):i=r}return t.push(i),i});var N=u(e.utils.unwrapObservable(t),O).sort(),$=u(n,O);A&&$.sort();var I,D,P=e.utils.compareArrays(N,$),F={},q=e.utils.unwrapObservable(n),B={},M=!0;for(I=0,D=q.length;D>I;I++){var L=O(q[I]);if(void 0===L||L instanceof Object){M=!1;break}B[L]=q[I]}var R=[],H=0;for(I=0,D=P.length;D>I;I++){var W,L=P[I],V=p+"["+I+"]";switch(L.status){case"added":var z=M?B[L.value]:c(e.utils.unwrapObservable(n),L.value,O);W=s(void 0,z,r,o,t,V,d),x()||(W=e.utils.unwrapObservable(W));var U=l(e.utils.unwrapObservable(n),z,F);W===j?H++:R[U-H]=W,F[U]=!0;break;case"retained":var z=M?B[L.value]:c(e.utils.unwrapObservable(n),L.value,O);W=c(t,L.value,O),s(W,z,r,o,t,V,d);var U=l(e.utils.unwrapObservable(n),z,F);R[U]=W,F[U]=!0;break;case"deleted":W=c(t,L.value,O)}E.push({event:L.status,item:W})}t(R),r[o]&&r[o].arrayChanged&&e.utils.arrayForEach(E,function(e){r[o].arrayChanged(e.event,e.item)})}else if(f(n)){if(t=e.utils.unwrapObservable(t),!t){if(x()){var G=k();return C()&&(G=T(G)),G}if(C())return T(G);t={}}if(C()&&(t=T(t)),_.save(n,t),C())return t;h(n,function(i){var o=p.length?p+"."+i:i;if(-1==e.utils.arrayIndexOf(r.ignore,o)){if(-1!=e.utils.arrayIndexOf(r.copy,o))return void(t[i]=n[i]);if("object"!=typeof n[i]&&"array"!=typeof n[i]&&r.observe.length>0&&-1==e.utils.arrayIndexOf(r.observe,o))return t[i]=n[i],void(r.copiedProperties[o]=!0);var a=_.get(n[i]),l=s(t[i],n[i],r,i,t,o,t),d=a||l;if(r.observe.length>0&&-1==e.utils.arrayIndexOf(r.observe,o))return t[i]=d(),void(r.copiedProperties[o]=!0);e.isWriteableObservable(t[i])?(d=e.utils.unwrapObservable(d),t[i]()!==d&&t[i](d)):(d=void 0===t[i]?d:e.utils.unwrapObservable(d),t[i]=d),r.mappedProperties[o]=!0}})}else switch(exports.getType(n)){case"function":C()?e.isWriteableObservable(n)?(n(T(n)),t=n):t=T(n):t=n;break;default:if(e.isWriteableObservable(t)){if(C()){var J=T(t);return t(J),J}var J=e.utils.unwrapObservable(n);return t(J),J}var K=x()||C();if(t=x()?k():e.observable(e.utils.unwrapObservable(n)),C()&&t(T(t)),K)return t}return t}function l(e,t,n){for(var i=0,r=e.length;r>i;i++)if(n[i]!==!0&&e[i]===t)return i;return null}function d(t,n){var i;return n&&(i=n(t)),"undefined"===exports.getType(i)&&(i=t),e.utils.unwrapObservable(i)}function c(t,n,i){t=e.utils.unwrapObservable(t);for(var r=0,o=t.length;o>r;r++){var a=t[r];if(d(a,i)===n)return a}throw new Error("When calling ko.update*, the key '"+n+"' was not found!")}function u(t,n){return e.utils.arrayMap(e.utils.unwrapObservable(t),function(e){return n?d(e,n):e})}function h(e,t){if("array"===exports.getType(e))for(var n=0;n<e.length;n++)t(n);else for(var i in e)t(i)}function f(e){var t=exports.getType(e);return("object"===t||"array"===t)&&null!==e}function p(e,t,n){var i=e||"";return"array"===exports.getType(t)?e&&(i+="["+n+"]"):(e&&(i+="."),i+=n),i}function g(){var t=[],n=[];this.save=function(i,r){var o=e.utils.arrayIndexOf(t,i);o>=0?n[o]=r:(t.push(i),n.push(r))},this.get=function(i){var r=e.utils.arrayIndexOf(t,i),o=r>=0?n[r]:void 0;return o}}function m(){var e={},t=function(t){var n;try{n=t}catch(i){n="$$$"}var r=e[n];return void 0===r&&(r=new g,e[n]=r),r};this.save=function(e,n){t(e).save(e,n)},this.get=function(e){return t(e).get(e)}}var v,_,b=!0,y="__ko_mapping__",w=e.dependentObservable,x=0,k=["create","update","key","arrayChanged"],j={},C={include:["_destroy"],ignore:[],copy:[],observe:[]},T=C;exports.isMapped=function(t){var n=e.utils.unwrapObservable(t);return n&&n[y]},exports.fromJS=function(e){if(0==arguments.length)throw new Error("When calling ko.fromJS, pass the object you want to convert.");try{x++||(v=[],_=new m);var t,n;2==arguments.length&&(arguments[1][y]?n=arguments[1]:t=arguments[1]),3==arguments.length&&(t=arguments[1],n=arguments[2]),n&&(t=i(t,n[y])),t=r(t);var o=s(n,e,t);if(n&&(o=n),!--x)for(;v.length;){var a=v.pop();a&&(a(),a.__DO.throttleEvaluation=a.throttleEvaluation)}return o[y]=i(o[y],t),o}catch(l){throw x=0,l}},exports.fromJSON=function(t){var n=e.utils.parseJson(t);return arguments[0]=n,exports.fromJS.apply(this,arguments)},exports.updateFromJS=function(){throw new Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!")},exports.updateFromJSON=function(){throw new Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!")},exports.toJS=function(t,n){if(T||exports.resetDefaultOptions(),0==arguments.length)throw new Error("When calling ko.mapping.toJS, pass the object you want to convert.");if("array"!==exports.getType(T.ignore))throw new Error("ko.mapping.defaultOptions().ignore should be an array.");if("array"!==exports.getType(T.include))throw new Error("ko.mapping.defaultOptions().include should be an array.");if("array"!==exports.getType(T.copy))throw new Error("ko.mapping.defaultOptions().copy should be an array.");return n=r(n,t[y]),exports.visitModel(t,function(t){return e.utils.unwrapObservable(t)},n)},exports.toJSON=function(t,n){var i=exports.toJS(t,n);return e.utils.stringifyJson(i)},exports.defaultOptions=function(){return arguments.length>0?void(T=arguments[0]):T},exports.resetDefaultOptions=function(){T={include:C.include.slice(0),ignore:C.ignore.slice(0),copy:C.copy.slice(0)}},exports.getType=function(e){if(e&&"object"==typeof e){if(e.constructor===Date)return"date";if(e.constructor===Array)return"array"}return typeof e},exports.visitModel=function(t,n,i){i=i||{},i.visitedObjects=i.visitedObjects||new m;var o,a=e.utils.unwrapObservable(t);if(!f(a))return n(t,i.parentName);i=r(i,a[y]),n(t,i.parentName),o="array"===exports.getType(a)?[]:{},i.visitedObjects.save(t,o);var s=i.parentName;return h(a,function(t){if(!i.ignore||-1==e.utils.arrayIndexOf(i.ignore,t)){var r=a[t];if(i.parentName=p(s,a,t),-1!==e.utils.arrayIndexOf(i.copy,t)||-1!==e.utils.arrayIndexOf(i.include,t)||!a[y]||!a[y].mappedProperties||a[y].mappedProperties[t]||!a[y].copiedProperties||a[y].copiedProperties[t]||"array"===exports.getType(a)){switch(exports.getType(e.utils.unwrapObservable(r))){case"object":case"array":case"undefined":var l=i.visitedObjects.get(r);o[t]="undefined"!==exports.getType(l)?l:exports.visitModel(r,n,i);break;default:o[t]=n(r,i.parentName)}}}}),o}});