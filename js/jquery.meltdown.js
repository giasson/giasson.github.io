!function(e,t,i,o){"use strict";function r(e){t.console&&f&&t.console.log(e)}function s(e,t,i){var o=e.editor,r=function(){var e=o.val(),i=o.getSelection(),r=t.before||"",s=t.placeholder||"",a=t.after||"";if(t.preselectLine){var n=e.lastIndexOf("\n",i.start)+1,l=e.indexOf("\n",i.end);-1===l&&(l=e.length),o.setSelection(n,l),i=o.getSelection()}if(i.length>0&&(s=i.text),t.isBlock)for(var d=0;2>d;d++){var h=e.charAt(i.start-1-d),p=e.charAt(i.end+d);"\n"!==h&&""!==h&&(r="\n"+r),"\n"!==p&&""!==p&&(a+="\n")}i.text!==s&&o.replaceSelectedText(s,"select"),o.surroundSelectedText(r,a,"select")};i.click(function(s){i.hasClass("disabled")||(t.click?t.click(e,t,i,r):r(),e.update()),o.focus(),s.preventDefault()})}function a(e){e.on("click",function(){e.siblings("li").removeClass(v+"_controlgroup-open").children("ul").hide(),e.toggleClass(v+"_controlgroup-open").children("ul").toggle()})}function n(t,i,l){var d=e("<ul />");l?(d.css("display","none"),d.addClass(v+"_controlgroup-"+i.name+" "+v+"_controlgroup-dropdown")):d.addClass("meltdown_controls");for(var h=0;h<i.length;h++){var p=i[h],u=e("<li />"),c=e("<span />").appendTo(u);if("string"===e.type(p)){if("|"===p){d.append(u.addClass(v+"_controlsep "+v+"_controlbutton"));continue}var f=e.meltdown.controlDefs[p];if(f===o){r("Control not found: "+p);continue}u.addClass(v+"_control-"+p+" "+v+"_control "+v+"_controlbutton "+(f.styleClass||"")),c.text(f.label).attr("title",f.altText),s(t,f,u)}else e.isArray(p)&&(u.addClass(v+"_controlgroup-"+p.name+" "+v+"_controlgroup "+v+"_controlbutton"),c.text(p.label).append('<i class="meltdown-icon-caret-down" />'),a(u),u.append(n(t,p,!0)));d.append(u)}return d}function l(t,i){i.click(function(i){var o=e('<div class"'+v+'_warning"/>').html('<center><b>The preview area is a tech preview feature</b></center><br/>Live previews <b>can</b> cause the browser tab to stop responding.<br/><br/>There is a <a target="_blank" href="https://github.com/iphands/Meltdown/issues/1">known issue</a> with <a target="_blank" href="https://github.com/tanakahisateru/js-markdown-extra#notice">one of the libraries</a> used to generate the live preview.<br/><br/>This warning will be removed when the issue is resolved.<br/><br/><center><i>Click to continue.</i></center>').css({background:"#fdd",cursor:"pointer"});o.on("click",function(i){e(i.target).is("a, a *")||t.update(!0)}),t.preview.empty().append(o),i.preventDefault()})}function d(e,t,i,o,r){e.addClass("meltdown_resizehandle-"+(o?"vert":"horiz"));var s,a,n,l,d,h=o?"height":"width",p=o?"pageY":"pageX",u=o?"lastEditorPercentHeight":"lastEditorPercentWidth",c=o?15:60,v=function(e){var c=Math.min(Math.max(e[p],a),n)-s,v=l+c,f=d-c;t[h](v),i[h](f),o||(t[0].style.maxWidth=v+"px",i[0].style.maxWidth=f+"px");var g=o?r.editor[0]:r.editorWrap[0],w=t[0]===g?v:f;r[u]=w/(v+f)};e.on("mousedown",function(e){if(r.isSidebyside()!==o){var u=t.add(i);t=u.first(),i=u.last(),s=e[p],l=t[h](),d=i[h](),a=s-l+c,n=s+d-c,b.on("mousemove",v).one("mouseup",function(){b.off("mousemove",v),k.removeClass("unselectable"),r.editor.focus()}),k.addClass("unselectable")}})}function h(e,t,i){var o,r,s,a=function(){e.apply(o,r)};return function(){return o=this,r=arguments,clearTimeout(s),s=setTimeout(a,t),i}}function p(e,t,i){return e!==!0&&e!==!1?!t:e===t?i?e:o:e}function u(e,t,i){var o=Math.round(t*e),r=e-o;return i>o?(r-=i-o,o=i):i>r&&(o-=i-r,r=i),{firstSize:o,lastSize:r}}for(var c="0.2",v="meltdown",f=!0,g=(i.all&&!i.addEventListener,[1,8,0]),w=e.fn.jquery.split(" ")[0].split("."),m=!1,b=e(i),k=e("body"),y=0;y<g.length;y++){var _=g[y],x=parseInt(w[y],10);if(_>x){isOldQuery=!0;break}if(x>_)break}var W=e('<div style="bottom: 0;" />'),C=function(e,t,i){return i.name=e,i.label=t,i};e.meltdown={version:c,controlsGroup:C,defaults:{controls:C("","",["preview","bold","italics","ul","ol","|","table",C("h","Headers",["h1","h2","h3","h4","h5","h6"]),"|",C("kitchenSink","Kitchen Sink",["link","img","blockquote","codeblock","code","footnote","hr"]),"fullscreen","sidebyside"]),fullscreen:!1,openPreview:!1,previewHeight:"editorHeight",previewCollapses:!0,sidebyside:!1,autoScrollPreview:!0,previewDuration:400,parser:t.Markdown},controlDefs:{bold:{label:"B",altText:"Bold",before:"**",after:"**"},italics:{label:"I",altText:"Italics",before:"*",after:"*"},ul:{label:"UL",altText:"Unordered List",preselectLine:!0,before:"* ",placeholder:"Item\n* Item",isBlock:!0},ol:{label:"OL",altText:"Ordered List",preselectLine:!0,before:"1. ",placeholder:"Item 1\n2. Item 2\n3. Item 3",isBlock:!0},table:{label:"Table",altText:"Table",before:"First Header  | Second Header\n------------- | -------------\nContent Cell  | Content Cell\nContent Cell  | Content Cell\n",isBlock:!0},link:{label:"Link",altText:"Link",before:"[",placeholder:"Example link",after:'](http:// "Link title")'},img:{label:"Image",altText:"Image",before:"![Alt text](",placeholder:"http://",after:")"},blockquote:{label:"Blockquote",altText:"Blockquote",preselectLine:!0,before:"> ",placeholder:"Quoted text",isBlock:!0},codeblock:{label:"Code Block",altText:"Code Block",preselectLine:!0,before:"~~~\n",placeholder:"Code",after:"\n~~~",isBlock:!0},code:{label:"Code",altText:"Inline Code",before:"`",placeholder:"code",after:"`"},footnote:{label:"Footnote",altText:"Footnote",before:"[^1]\n\n[^1]:",placeholder:"Example footnote",isBlock:!0},hr:{label:"HR",altText:"Horizontal Rule",before:"----------",placeholder:"",isBlock:!0},fullscreen:{label:"Fullscreen",altText:"Toggle fullscreen",click:function(e){e.toggleFullscreen()}},sidebyside:{label:"Sidebyside",altText:"Toggle sidebyside",click:function(e){e.toggleSidebyside()}},preview:{label:"Preview",altText:"Toggle preview",click:function(e){e.togglePreview()}}}},function(e){for(var t="",i=1;6>=i;i++)t+="#",e["h"+i]={label:"H"+i,altText:"Header "+i,preselectLine:!0,before:t+" "}}(e.meltdown.controlDefs);var j=e.meltdown.Meltdown=function(t){this.element=e(t)};e.meltdown.methods=e.extend(j.prototype,{_init:function(t){var i=this,r=this._options=e.extend({},e.meltdown.defaults,t);this._lastUpdateText="",this.parser=r.parser||function(e){return e},this.editorPreInitOuterWidth=this.element.outerWidth(),this.wrap=e('<div class="'+v+'_wrap previewopen" />'),this.topmargin=e('<div class="'+v+'_topmargin"/>').appendTo(this.wrap),this.bar=e('<div class="meltdown_bar"></div>').appendTo(this.wrap),this.editorWrap=e('<div class="'+v+'_editor-wrap" />').appendTo(this.wrap),this.editorDeco=e('<div class="'+v+'_editor-deco" />').appendTo(this.editorWrap),this.editor=this.element.addClass("meltdown_editor"),this.previewWrap=e('<div class="'+v+'_preview-wrap" />').appendTo(this.wrap),this.resizeHandle=e('<div class="'+v+'_resizehandle"><span></span></div>').appendTo(this.previewWrap),this.previewHeader=e('<span class="'+v+'_preview-header">Preview Area (<a class="meltdown_techpreview" href="https://github.com/iphands/Meltdown/issues/1">Tech Preview</a>)</span>').appendTo(this.previewWrap),this.preview=e('<div class="'+v+'_preview" />').appendTo(this.previewWrap),this.bottommargin=e('<div class="'+v+'_bottommargin"/>').appendTo(this.wrap),this.wrap.outerWidth(this.editorPreInitOuterWidth),m&&this.wrap.width(this.editorPreInitOuterWidth);var s=r.previewHeight;"editorHeight"===s&&(s=this.editor.height()),this.preview.height(s),this.controls=n(this,r.controls).appendTo(this.bar),l(this,this.previewHeader.find(".meltdown_techpreview")),this.editor.focus(function(){i.editorDeco.addClass("focus")}).blur(function(){i.editorDeco.removeClass("focus")}),this.previewWrap2=e('<div class="'+v+'_preview-wrap2"></div>').appendTo(this.previewWrap),this.previewWrap2.append(this.resizeHandle,this.previewHeader,this.preview),d(this.resizeHandle,this.editor,this.preview,!0,this),d(this.resizeHandle,this.editorWrap,this.previewWrap,!1,this),this.debouncedUpdate=h(this.update,350,this),this.editor.on("keyup",e.proxy(this.debouncedUpdate,this)),this.fullscreenData={},this.editor.after(this.wrap).appendTo(this.editorDeco),this._checkToolbarOverflowedControls(),this._previewCollapses=r.previewCollapses,this.togglePreview(!0,0,!0,!r.openPreview),this.isPreviewCollapses()||"auto"!==r.previewHeight||this.preview.height("+=0"),this._checkHeightsManaged("",o,!0);var a=this.wrap.height(),p=parseFloat(this.editor.css("minHeight"))+parseFloat(this.preview.css("minHeight")),u=this.editor.height();return s=this.preview.height(),this.wrap.css("minHeight",a-u-s+p),this.lastWrapWidth=this.wrap.width(),this.lastWrapHeight=a,this.lastEditorPercentWidth=.5,this.lastEditorPercentHeight=u/(u+s),addResizeListener(this.wrap[0],e.proxy(this._wrapResizeListener,this)),r.openPreview||this.togglePreview(!1,0),this.toggleSidebyside(r.sidebyside,!0),r.fullscreen&&this.toggleFullscreen(r.fullscreen),this},options:function(e,t){return 1===arguments.length?this._options[e]:arguments.length>1?(this._options[e]=t,this):void 0},update:function(e){return this.updateWith(this.editor.val(),e)},updateWith:function(e,t){if(t===!0||this.isPreviewOpen()&&e!==this._lastUpdateText){var i=this.preview[0],o=i.scrollHeight-i.scrollTop===i.clientHeight;this.preview.html(this.parser(e)),o&&(i.scrollTop=i.scrollHeight),this._lastUpdateText=e}return this},isPreviewOpen:function(){return this.wrap.hasClass("previewopen")},togglePreview:function(t,i,r,s){if(t=p(t,this.isPreviewOpen(),r),t===o)return this;i===o&&(i=this._options.previewDuration);var a=this,n=this.editor.height(),l=t?0:this.previewWrap.outerHeight(),d=n+l,h=this._isHeightsManaged()?function(){a.editor.height(d-a.previewWrap.outerHeight())}:e.noop,c=this.editorWrap.width(),v=t?0:this.previewWrap.width(),f=function(e){a.previewWrap[0].style.maxWidth=e+"px";var t=c+(v-e);a.editorWrap.width(t),a.editorWrap[0].style.maxWidth=t+"px"},g=function(){a.previewWrap.css("display","")};if(t)if(this.wrap.addClass("previewopen"),s||this.update(),this.isSidebyside())this.previewWrap.stop().animate({width:"show"},{duration:i,step:f,start:function(e){var t=u(a.wrap.width(),a.lastEditorPercentWidth,60);e.tweens[0].end=t.lastSize,g()},complete:g});else{var w=this.previewWrap.outerHeight();this._heightsManaged&&w>n-15&&this.preview.height("-="+(w-(n-15))),m?(this._heightsManaged&&this.editor.height("-="+w),this.previewWrap.stop().show(),g()):this.previewWrap.stop().slideDown({duration:i,progress:h,start:g,complete:g})}else this.isSidebyside()?this.previewWrap.stop().animate({width:"hide"},{duration:i,step:f,complete:function(){a.previewWrap.css("max-width","")}}):!m&&this.previewWrap.is(":visible")&&i>0?this.previewWrap.stop().slideUp({duration:i,progress:h}):(this.previewWrap.stop().hide(),this._heightsManaged&&this.editor.height(d)),this.wrap.removeClass("previewopen");return this},isFullscreen:function(){return this.wrap.hasClass("fullscreen")},toggleFullscreen:function(e){if(e=p(e,this.isFullscreen()),e===o)return this;var t=this.fullscreenData;if(e){t.originalWrapHeight=this.wrap.height(),t.availableHeight=this.editor.height()+this.preview.height(),t.originalWrapStyleHeight=this.wrap[0].style.height,this._checkHeightsManaged("fullscreen",!0),this.wrap.addClass("fullscreen");var i=this;b.on("keypress."+v+".fullscreenEscKey",function(e){27===e.keyCode&&i.toggleFullscreen(!1)})}else{if(b.off("keypress."+v+".fullscreenEscKey"),this.wrap.removeClass("fullscreen"),this._isHeightsManaged())this._adjustHeights(t.originalWrapHeight),this.lastWrapHeight=t.originalWrapHeight;else{var r=u(t.availableHeight,this.lastEditorPercentHeight,15);this.editor.height(r.firstSize),this.preview.height(r.lastSize)}this._checkHeightsManaged("fullscreen",!1),this.wrap[0].style.height=t.originalWrapStyleHeight}return this._wrapResizeListener(),this},isSidebyside:function(){return this.wrap.hasClass("sidebyside")},toggleSidebyside:function(e,t){if(e=p(e,this.isSidebyside(),t),e===o)return this;var i=this.isPreviewOpen(),r=this.bottommargin.offset().top;if(e){this.wrap.addClass("sidebyside"),this._adjustWidths(this.wrap.width()),i||this.togglePreview(!0,0,!1,!0);var s=W.appendTo(this.editorWrap).offset().top,a=W.appendTo(this.previewWrap).offset().top;W.detach(),i||this.togglePreview(!1,0,!1,!0);var n=s-a;this.preview.height("+="+n);var l=r-this.bottommargin.offset().top;this.editor.height("+="+l),this.preview.height("+="+l),this._checkHeightsManaged("sidebyside",!0)}else{i||this.togglePreview(!0,0,!1,!0);var d=this.wrap.height();this.editorWrap.css("width",""),this._checkHeightsManaged("sidebyside",!1),this.editorWrap.css({width:"",maxWidth:""}),this.previewWrap.css({width:"",maxWidth:""}),this.wrap.removeClass("sidebyside");var h=this.bottommargin.offset().top-r;this.lastWrapHeight=d+h,this._adjustHeights(d),this.lastWrapHeight=d,i||this.togglePreview(!1,0,!1,!0)}return this},isPreviewCollapses:function(){return this._previewCollapses},togglePreviewCollapses:function(e,t){return e=p(e,this._previewCollapses,t),e===o?this:(this._previewCollapses=e,this._checkHeightsManaged(),this)},_isHeightsManaged:function(){return this._heightsManaged},_toggleHeightsManaged:function(e,t){return e=p(e,this._heightsManaged,t),e===o?this:(e?this.wrap.height("+=0").addClass("heightsManaged"):this.wrap.height("auto").removeClass("heightsManaged"),this._heightsManaged=e,this)},_checkHeightsManaged:function(e,t,i){var o="previewCollapses"===e?t:this._previewCollapses,r="fullscreen"===e?t:this.isFullscreen(),s="sidebyside"===e?t:this.isSidebyside(),a=!o||r||s;(i||a!==this._heightsManaged)&&this._toggleHeightsManaged(a,i)},_wrapResizeListener:function(){var e=this.wrap.width(),t=this.wrap.height();if(e!==this.lastWrapWidth&&(this._checkToolbarOverflowedControls(),this._adjustWidths(e),this.lastWrapWidth=e),t!==this.lastWrapHeight){if(this._heightsManaged)this._adjustHeights(t);else{var i=this.editor.height();this.lastEditorPercentHeight=i/(i+this.preview.height())}this.lastWrapHeight=t}},_adjustHeights:function(e){var t;if(this.isSidebyside()){var i=e-this.lastWrapHeight;t={firstSize:this.editor.height()+i,lastSize:this.preview.height()+i}}else{var o=this.isPreviewOpen(),r=this.editor.height(),s=o?this.preview.height():0,a=r+s+(e-this.lastWrapHeight);t=u(a,this.lastEditorPercentHeight,15),o||(t.firstSize=r+(e-this.lastWrapHeight))}return this.editor.height(t.firstSize),this.preview.height(t.lastSize),this},_adjustWidths:function(e){if(this.isSidebyside()){var t=u(e,this.lastEditorPercentWidth,60);this.isPreviewOpen()||(t.firstSize+=t.lastSize),this.editorWrap.width(t.firstSize),this.previewWrap.width(t.lastSize),this.editorWrap[0].style.maxWidth=t.firstSize+"px",this.previewWrap[0].style.maxWidth=t.lastSize+"px"}return this},_checkToolbarOverflowedControls:function(){for(var t=this.controls.children(),i=e(t[0]),o=i.position().top,r=!1,s=t.length-1;s>1;s--)if(i=e(t[s]),!i.hasClass("overflowedControl")){if(i.position().top<=o)break;i.addClass("overflowedControl"),r=!0}if(!r)for(;s<t.length;s++)if(i=e(t[s]),e(t[s]).hasClass("overflowedControl")&&(i.removeClass("overflowedControl"),i.position().top>o)){i.addClass("overflowedControl");break}return this}}),e.fn.meltdown=function(t){for(var i,o,r,s="string"===e.type(t)?t:"_init",a=Array.prototype.slice.call(arguments,"_init"===s?0:1),n=0;n<this.length;n++){if(i=this[n],o=e.data(i,"Meltdown"),"_init"===s){if(o)continue;o=new j(i),e.data(i,"Meltdown",o)}if(r=o[s].apply(o,a),r!==o)return r}return this};var H=n;n=function(){var e=H.apply(this,arguments);return e.find("span").attr("unselectable","on"),e},m&&(e.meltdown.controlDefs.sidebyside.styleClass="disabled",e.meltdown.controlDefs.sidebyside.altText="Disabled: requires jQuery 1.8+",j.prototype.toggleSidebyside=function(){return r("Requires jQuery 1.8+"),this})}(jQuery,window,document);